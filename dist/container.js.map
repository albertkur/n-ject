{"version":3,"file":"container.js","sourceRoot":"","sources":["../src/container.ts"],"names":[],"mappings":"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","sourcesContent":["import { given } from \"n-defensive\";\nimport { Scope } from \"./scope\";\nimport { BaseScope } from \"./base-scope\";\nimport { ComponentRegistry } from \"./component-registry\";\nimport { ScopeType } from \"./scope-type\";\nimport { Lifestyle } from \"./lifestyle\";\nimport { ChildScope } from \"./child-scope\";\nimport { ComponentInstaller } from \"./component-installer\";\nimport { Registry } from \"./registry\";\nimport { InvalidOperationException } from \"n-exception\";\n\n// public\nexport class Container extends BaseScope implements Registry\n{\n    public constructor()\n    {\n        super(ScopeType.Root, new ComponentRegistry(), null);\n    }\n\n    public registerTransient(key: string, component: Function): Registry\n    {\n        this.register(key, component, Lifestyle.Transient);\n        return this;\n    }\n    \n    public registerScoped(key: string, component: Function): Registry\n    {\n        this.register(key, component, Lifestyle.Scoped);\n        return this;\n    }\n    \n    public registerSingleton(key: string, component: Function): Registry\n    {\n        this.register(key, component, Lifestyle.Singleton);\n        return this;\n    }\n    \n    public registerInstance(key: string, instance: any): Registry\n    {\n        this.register(key, instance, Lifestyle.Instance);\n        return this;\n    }\n    \n    public install(componentInstaller: ComponentInstaller): Container\n    {\n        if (this.isBootstrapped)\n            throw new InvalidOperationException(\"install after bootstrap\");    \n        \n        given(componentInstaller, \"componentInstaller\").ensureHasValue();\n        componentInstaller.install(this);\n        return this;\n    }\n\n    public createScope(): Scope\n    {\n        if (!this.isBootstrapped)\n            throw new InvalidOperationException(\"createScope after bootstrap\");\n        \n        return new ChildScope(this.componentRegistry, this);\n    }\n\n    public bootstrap(): void\n    {\n        if (this.isBootstrapped)\n            throw new InvalidOperationException(\"bootstrap after bootstrap\");\n\n        this.componentRegistry.verifyRegistrations();\n        \n        super.bootstrap();\n    }\n    \n    private register(key: string, component: Function, lifestyle: Lifestyle): void\n    {\n        if (this.isBootstrapped)\n            throw new InvalidOperationException(\"register after bootstrap\");\n\n        given(key, \"key\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace());\n        given(component, \"component\").ensureHasValue();\n        given(lifestyle, \"lifestyle\").ensureHasValue();\n        if (lifestyle !== Lifestyle.Instance)\n            given(component, \"component\").ensure(t => typeof t === \"function\");\n\n        this.componentRegistry.register(key, component, lifestyle);\n    }\n}"]}